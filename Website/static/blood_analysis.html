 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Cardiovascular Disease Risks Detection</title>
    <!-- Lien vers le fichier CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Glass+Antiqua&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/blood_analysis.css">
</head>
<body>

<header>
    <h1>Cardiovascular Disease Risks Detection</h1>
    <nav>
        <a href="/">Home</a>
        <a href="/blood_analysis">Blood Analysis</a>
        <a href="/aboutUs">About Us</a>
    </nav>
</header>

<div class="container">
    <div class="header">
        <h1>Analysis: Cardiovascular Disease Risks Detection</h1>
    </div>

    <form id="riskForm">
        <h3>Formulaire</h3>
        <div class="form-grid">
            <!-- Formulaire -->
            <label for="sexe">Sexe</label>
            <select id="sexe" name="sexe">
                <option value="homme">Homme</option>
                <option value="femme">Femme</option>
            </select>

            <label for="age">Âge</label>
            <input type="number" id="age" name="age" min="0" max="99" required>

            <label for="poids">Poids (kg)</label>
            <input type="number" id="poids" name="poids" min="0" step="0.1" oninput="calculateBMI()" required>

            <label for="taille">Taille (m)</label>
            <input type="number" id="taille" name="taille" min="1" step="0.01" oninput="calculateBMI()" required>

            <label for="tension">Tension Artérielle Élevée</label>
            <select id="tension" name="tension">
                <option value="oui">Oui</option>
                <option value="non">Non</option>
            </select>

            <label for="bmi">IMC</label>
            <input type="text" id="bmi" name="bmi" readonly>

            <label for="cholesterol">Taux de Cholestérol Élevé</label>
            <select id="cholesterol" name="cholesterol">
                <option value="oui">Oui</option>
                <option value="non">Non</option>
            </select>

            <label for="avc">AVC</label>
            <select id="avc" name="avc">
                <option value="oui">Oui</option>
                <option value="non">Non</option>
            </select>

            <label for="DiffWalk">Difficultés Physiques</label>
            <select id="DiffWalk" name="DiffWalk">
                <option value="oui">Oui</option>
                <option value="non">Non</option>
            </select>

            <label for="education">Années de Formation Après le Bac</label>
            <select id="education" name="education">
                <script>
                    for (let i = 1; i <= 15; i++) {
                        document.write(`<option value="${i}">${i}</option>`);
                    }
                </script>
            </select>

            <label for="income">Revenu Mensuel (€)</label>
            <select id="income" name="income">
            <script>
                for (let i = 1; i <= 6; i++) {
                    document.write(`<option value="${i}">${i}</option>`);
                }
            </script>
            </select>
            <!--<input type="number" id="income" name="income" required>-->
        </div>

        <button type="submit" class="submit-btn">Submit</button>
    </form>

    <!-- Zone d'affichage des résultats -->
    <div id="resultDisplay" class="result-display"></div>

    <script>
        // Calcul de l'IMC
        function calculateBMI() {
            const poids = parseFloat(document.getElementById("poids").value);
            const taille = parseFloat(document.getElementById("taille").value);

            if (poids > 0 && taille > 1) {
                const bmi = (poids / (taille * taille)).toFixed(2);
                document.getElementById("bmi").value = bmi;
            } else {
                document.getElementById("bmi").value = "";
            }
        }

        // Envoi des données et gestion des résultats
        document.getElementById("riskForm").addEventListener("submit", async (event) => {
            event.preventDefault();

            // Rassembler les données du formulaire
            const formData = {
                sexe: document.getElementById("sexe").value === "homme" ? 1 : 0,
                age: parseInt(document.getElementById("age").value),
                bmi: parseFloat(document.getElementById("bmi").value),
                tension: document.getElementById("tension").value === "oui" ? 1 : 0,
                cholesterol: document.getElementById("cholesterol").value === "oui" ? 1 : 0,
                avc: document.getElementById("avc").value === "oui" ? 1 : 0,
                diffWalk: document.getElementById("DiffWalk").value === "oui" ? 1 : 0,
                education: parseInt(document.getElementById("education").value),
                income: parseFloat(document.getElementById("income").value)
            };

            try {
                // Envoyer les données au backend
                const response = await fetch("/predict", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ features: Object.values(formData) })
                });

                const result = await response.json();

                // Afficher le message de résultat
                const resultDiv = document.getElementById("resultDisplay");
                resultDiv.innerHTML = `<h3>Résultat:</h3><p>${result.message}</p>`;
                resultDiv.style.color = result.prediction === 0 ? "green" : "red";

            } catch (error) {
                console.error("Erreur lors de la soumission du formulaire :", error);
            }
        });
    </script>
</div>

</body>
</html>
